<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RaituSaarthi - AI Farming Assistant</title>
<style>
  body { font-family: 'Inter', sans-serif; background: #f0fdf4; margin:0; display:flex; flex-direction:column; height:100vh; }
  header { background: linear-gradient(135deg,#10b981,#059669); color:white; padding:1rem 2rem; text-align:center; font-size:1.5rem; font-weight:600; }
  #chatContainer { flex:1; display:flex; flex-direction:column; padding:1rem; overflow-y:auto; }
  .message { padding:0.8rem 1rem; border-radius:12px; margin:0.5rem 0; max-width:80%; }
  .user { background:#dcfce7; align-self:flex-end; }
  .bot { background:#fef3c7; align-self:flex-start; }
  footer { display:flex; padding:1rem; gap:0.5rem; background:white; border-top:1px solid #e2e8f0; }
  #userInput { flex:1; padding:0.8rem 1rem; border-radius:12px; border:1px solid #10b981; font-size:1rem; }
  #sendBtn, #voiceBtn { padding:0 1rem; background:#10b981; color:white; border:none; border-radius:12px; cursor:pointer; font-weight:600; transition:0.2s; }
  #sendBtn:hover, #voiceBtn:hover { background:#059669; }
</style>
</head>
<body>
<header>ðŸŒ¾ RaituSaarthi - Your AI Farming Assistant</header>
<div id="chatContainer"></div>
<footer>
  <input type="text" id="userInput" placeholder="Ask me about crops, soil, weather..." />
  <button id="voiceBtn">ðŸŽ¤</button>
  <button id="sendBtn">Send</button>
</footer>

<script>
const chatContainer = document.getElementById('chatContainer');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const voiceBtn = document.getElementById('voiceBtn');

// Add message to chat
function addMessage(text, sender='bot') {
  const msgDiv = document.createElement('div');
  msgDiv.classList.add('message', sender);
  msgDiv.textContent = text;
  chatContainer.appendChild(msgDiv);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Detect language
function detectLanguage(text){
  if(/[à°…-à°¹]/.test(text)) return 'te-IN';
  if(/[à¤•-à¤¹]/.test(text)) return 'hi-IN';
  return 'en-US';
}

// Text-to-Speech
function speak(text, lang='en-US') {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = lang;
  speechSynthesis.speak(utterance);
}

// Fetch AI response from Flask
async function getAIResponse(message) {
  const langCode = detectLanguage(message);
  let language = 'English';
  if(langCode==='hi-IN') language='Hindi';
  else if(langCode==='te-IN') language='Telugu';

  try {
   const res = await fetch('/api/chat', {
  method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ message, language })
    });
    const data = await res.json();
    return data.reply;
  } catch(e){
    console.error(e);
    return "Sorry, I couldn't get an answer right now.";
  }
}

// Send message
async function sendMessage() {
  const message = userInput.value.trim();
  if(!message) return;

  addMessage(message, 'user');
  const aiResponse = await getAIResponse(message);
  addMessage(aiResponse, 'bot');
  speak(aiResponse, detectLanguage(message));
  userInput.value='';
}

// Events
sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e)=>{ if(e.key==='Enter') sendMessage(); });

// Voice input
voiceBtn.addEventListener('click', () => {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-IN';
  recognition.start();
  recognition.onresult = (event)=>{
    userInput.value = event.results[0][0].transcript;
    sendMessage();
  };
});

// Welcome message
addMessage("ðŸŒ¾ Namaste! I am RaituSaarthi. Ask me anything about farming in English, Hindi, or Telugu.", 'bot');
speak("Namaste! I am RaituSaarthi. Ask me anything about farming in English, Hindi, or Telugu.");
</script>
</body>
</html>